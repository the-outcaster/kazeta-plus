#! /bin/bash

if [ $EUID -ne 0 ]; then
    echo "$(basename $0) must be run as root"
    exit 1
fi

# More robust interface detection
interface=$(ip link | grep -E '^[0-9]+: (en|eth)' | head -1 | cut -d':' -f2 | tr -d ' ')

if [ -z "$interface" ]; then
    echo "No Ethernet interface found"
    exit 1
fi

echo "[Match]
Name=$interface

[Network]
DHCP=yes" > /etc/systemd/network/20-wired.network

# Enable services to start on boot
systemctl enable systemd-networkd
systemctl enable systemd-resolved

# Restart networking services
systemctl restart systemd-networkd
systemctl restart systemd-resolved

# Wait and check IP
sleep 5
ip addr show $interface
